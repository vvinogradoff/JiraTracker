<Window x:Class="UpworkJiraTracker.View.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:UpworkJiraTracker.XAML"
        xmlns:converters="clr-namespace:UpworkJiraTracker.XAML.Converter"
        xmlns:vm="clr-namespace:UpworkJiraTracker.ViewModel"
        mc:Ignorable="d"
		Icon="pack://application:,,,/icon.ico"
        Title="Settings"
        Height="500"
        Width="320"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        ShowInTaskbar="False"
        ResizeMode="NoResize"
        Deactivated="Window_Deactivated"
		d:DataContext="{d:DesignInstance Type=vm:SettingsViewModel, IsDesignTimeCreatable=True}">

	<Window.Resources>
		<converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
		<converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
		<converters:UpworkStateToFillConverter x:Key="UpworkStateToFillConverter"/>
		<converters:UpworkStateToTooltipConverter x:Key="UpworkStateToTooltipConverter"
												   NoProcessText="No Upwork process was found"
												   CannotAutomateText="Upwork desktop tracker application must be started with --enable-features=UiaProvider"
												   FullyAutomatedText="Upwork is connected and automated"
												   UnknownStateText="Unknown state"/>
		<converters:DeelConnectedToFillConverter x:Key="DeelConnectedToFillConverter"/>
		<converters:DeelConnectedToTooltipConverter x:Key="DeelConnectedToTooltipConverter"
													DisconnectedText="Left-click: Embedded browser | Right-click: Standalone"
													ConnectedText="Left-click: Embedded | Right-click: Standalone"/>
		<converters:JiraConnectedToFillConverter x:Key="JiraConnectedToFillConverter"/>
		<converters:JiraConnectedToTooltipConverter x:Key="JiraConnectedToTooltipConverter"
													DisconnectedText="Click to connect to Jira"
													ConnectedText="Click to disconnect from Jira"/>
	</Window.Resources>

	<Grid>
		<Border Background="White"
            BorderBrush="#CCCCCC"
            BorderThickness="1"
            CornerRadius="6"
            Padding="0">
			<Border.Effect>
				<DropShadowEffect BlurRadius="15"
                            ShadowDepth="2"
                            Opacity="0.3"
                            Color="Black"/>
			</Border.Effect>

			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="*"/>
				</Grid.RowDefinitions>

				<!-- Title bar with minimize and close buttons -->
				<Border Grid.Row="0"
                   Background="#F5F5F5"
                   BorderBrush="#CCCCCC"
                   BorderThickness="0,0,0,1"
                   CornerRadius="6,6,0,0"
                   Padding="12,8">
					<Grid>
						<TextBlock Text="Settings"
                              Style="{StaticResource StyleSettingsTitle}"/>

						<StackPanel Orientation="Horizontal"
                               HorizontalAlignment="Right">
							<Button x:Name="MinimizeButton"
                               Content="âˆ’"
                               Margin="0,0,8,0"
                               Style="{StaticResource StyleCloseButton}"
                               Command="{Binding MinimizeCommand}"/>
							<Button x:Name="CloseButton"
                               Content="âœ•"
                               Style="{StaticResource StyleCloseButton}"
                               Command="{Binding CloseCommand}"/>
						</StackPanel>
					</Grid>
				</Border>

				<!-- Settings content -->
				<StackPanel Grid.Row="1"
                       Margin="16">

					<!-- Timezones -->
					<StackPanel Margin="0,0,0,12">
						<Grid>
							<TextBlock Text="Timezones:"
                                  Style="{StaticResource StyleSettingsLabel}"
                                  HorizontalAlignment="Left"/>
							<Button Content="+ Add"
                               HorizontalAlignment="Right"
                               Style="{StaticResource StyleAddButton}"
                               Command="{Binding AddTimezoneCommand}"/>
						</Grid>
						<ListBox x:Name="TimezonesListBox"
                            ItemsSource="{Binding Timezones}"
                            Height="100"
                            BorderBrush="#CCCCCC"
                            BorderThickness="1"
                            Padding="4">
							<ListBox.ItemTemplate>
								<DataTemplate>
									<Grid Margin="0,2">
										<Grid.ColumnDefinitions>
											<ColumnDefinition Width="*"/>
											<ColumnDefinition Width="Auto"/>
										</Grid.ColumnDefinitions>
										<TextBlock Grid.Column="0">
                                            <Run Text="{Binding Caption}" FontWeight="SemiBold"/>
                                            <Run Text=" - " Foreground="#999999"/>
                                            <Run Text="{Binding TimeZoneId}" FontSize="10" Foreground="#666666"/>
										</TextBlock>
										<Button Grid.Column="1"
                                           Content="âœ•"
                                           Style="{StaticResource StyleRemoveButton}"
                                           Command="{Binding DataContext.RemoveTimezoneCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                           CommandParameter="{Binding}"/>
									</Grid>
								</DataTemplate>
							</ListBox.ItemTemplate>
						</ListBox>
					</StackPanel>

					<!-- Window Size and Color -->
					<Grid Margin="0,0,0,4">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>
						<Grid.RowDefinitions>
							<RowDefinition/>
							<RowDefinition/>
						</Grid.RowDefinitions>

						<TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
							   Text="Window Size:"
							   Style="{StaticResource StyleSettingsLabel}"/>

						<TextBox Grid.Row="1" Grid.Column="0"
								 Text="{Binding MainWindowWidth, UpdateSourceTrigger=PropertyChanged}"
								 HorizontalContentAlignment="Center"
								 VerticalAlignment="Center"
								 Style="{StaticResource StyleSettingsInput}"
								 Margin="0,0,4,0"/>

						<TextBox Grid.Row="1" Grid.Column="1"
								 Text="{Binding MainWindowHeight, UpdateSourceTrigger=PropertyChanged}"
								 HorizontalContentAlignment="Center"
								 VerticalAlignment="Center"
								 Style="{StaticResource StyleSettingsInput}"
								 Margin="0,0,4,0"/>

						<TextBlock Grid.Row="0" Grid.Column="2" Grid.ColumnSpan="3"
								   Text="Background Color:"
								   Style="{StaticResource StyleSettingsLabel}"/>
						<Button Grid.Row="1" Grid.Column="2"  x:Name="ColorPreview"
								Content="ðŸŽ¨"
								Margin="0,0,4,0"
								Background="#333333"
								Command="{Binding PickColorCommand}"
								Style="{StaticResource SecondaryButtonStyle}"/>
						<Button Grid.Row="1" Grid.Column="3"
								Content="ðŸŽ¨"
								Command="{Binding ResetColorCommand}"
								Style="{StaticResource SecondaryButtonStyle}"
								Margin="0,0,4,0"/>
						<Button Grid.Row="1" Grid.Column="4"
								Content="â¬œ"
								Command="{Binding TransparentColorCommand}"
								Style="{StaticResource SecondaryButtonStyle}"
								ToolTip="Set transparent background"/>
					</Grid>

					<!-- Integrations -->
					<Grid Margin="0,12,0,0">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>
						<Grid.RowDefinitions>
							<RowDefinition Height="Auto"/>
							<RowDefinition Height="*"/>
							<RowDefinition Height="Auto"/>
						</Grid.RowDefinitions>
						<TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
								   Text="Integrations:"
								   Style="{StaticResource StyleSettingsLabel}"/>

						<!-- Jira Logo (clickable) -->
						<Border Grid.Column="0" Grid.Row="1"
								HorizontalAlignment="Center"
								VerticalAlignment="Center"
								Cursor="Hand"
								MouseDown="JiraIcon_MouseDown"
								Background="Transparent"
								ToolTip="{Binding IsJiraConnected, Converter={StaticResource JiraConnectedToTooltipConverter}}">
							<Viewbox Width="70" Height="32">
								<Canvas Width="76" Height="32">
									<!-- Icon: three overlapping document shapes -->
									<Path Data="{StaticResource JiraLogoPathIcon1}"
										  Fill="{Binding IsJiraConnected, Converter={StaticResource JiraConnectedToFillConverter}, ConverterParameter=#2684FF}"/>
									<Path Data="{StaticResource JiraLogoPathIcon2}"
										  Fill="{Binding IsJiraConnected, Converter={StaticResource JiraConnectedToFillConverter}, ConverterParameter=#2684FF}"/>
									<Path Data="{StaticResource JiraLogoPathIcon3}"
										  Fill="{Binding IsJiraConnected, Converter={StaticResource JiraConnectedToFillConverter}, ConverterParameter=#2684FF}"/>
									<!-- Text: "Jira" -->
									<Path Data="{StaticResource JiraLogoPathJ}"
										  Fill="{Binding IsJiraConnected, Converter={StaticResource JiraConnectedToFillConverter}, ConverterParameter=#253858}"/>
									<Path Data="{StaticResource JiraLogoPathI}"
										  Fill="{Binding IsJiraConnected, Converter={StaticResource JiraConnectedToFillConverter}, ConverterParameter=#253858}"/>
									<Path Data="{StaticResource JiraLogoPathR}"
										  Fill="{Binding IsJiraConnected, Converter={StaticResource JiraConnectedToFillConverter}, ConverterParameter=#253858}"/>
									<Path Data="{StaticResource JiraLogoPathA}"
										  Fill="{Binding IsJiraConnected, Converter={StaticResource JiraConnectedToFillConverter}, ConverterParameter=#253858}"/>
								</Canvas>
							</Viewbox>
						</Border>

						<!-- Upwork Icon -->
						<Border Grid.Column="1" Grid.Row="1"
								HorizontalAlignment="Center"
								VerticalAlignment="Center"
								ToolTip="{Binding UpworkState, Converter={StaticResource UpworkStateToTooltipConverter}}">
							<Viewbox Width="90" Height="45">
								<Canvas Width="120" Height="60">
									<Path Data="{StaticResource UpworkLogoPath1}"
										  Fill="{Binding UpworkState, Converter={StaticResource UpworkStateToFillConverter}, ConverterParameter=#4b4b4b}"/>
									<Path Data="{StaticResource UpworkLogoPath2}"
										  Fill="{Binding UpworkState, Converter={StaticResource UpworkStateToFillConverter}, ConverterParameter=#6fda44}"/>
								</Canvas>
							</Viewbox>
						</Border>

						<!-- Deel Icon (clickable) -->
						<Border Grid.Column="2" Grid.Row="1"
								HorizontalAlignment="Center"
								VerticalAlignment="Center"
								Cursor="Hand"
								MouseDown="DeelIcon_MouseDown"
								Background="Transparent"
								ToolTip="{Binding IsDeelConnected, Converter={StaticResource DeelConnectedToTooltipConverter}}">
							<Viewbox Width="60" Height="45" Stretch="Uniform" Margin="0,-6,0,0">
								<Canvas Width="214" Height="76">
									<Path Data="{StaticResource DeelLogoPathText}"
										  Fill="{Binding IsDeelConnected, Converter={StaticResource DeelConnectedToFillConverter}, ConverterParameter=#01090f}"/>
									<Path Data="{StaticResource DeelLogoPathDot}"
										  Fill="{Binding IsDeelConnected, Converter={StaticResource DeelConnectedToFillConverter}, ConverterParameter=#2c71f0}"/>
								</Canvas>
							</Viewbox>
						</Border>

						<!-- Deel show checkbox -->
						<CheckBox Grid.Column="2" Grid.Row="0"
								  Content="show"
								  HorizontalAlignment="Center"
								  VerticalAlignment="Bottom"
								  IsChecked="{Binding ShowDeelBrowser}"
								  ToolTip="Show Deel browser window when logging (uncheck to hide completely)"/>

					</Grid>

					<!-- Log Directory -->
					<Grid Margin="0,12,0,0">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>
						<Grid.RowDefinitions>
							<RowDefinition Height="Auto"/>
							<RowDefinition Height="*"/>
							<RowDefinition Height="Auto"/>
						</Grid.RowDefinitions>
						<TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
								   Text="Log Directory:" 
								   Style="{StaticResource StyleSettingsLabel}"/>
						<TextBlock Grid.Row="0" Grid.Column="2"
								   Text="Timesheet:" 
								   Style="{StaticResource StyleSettingsLabel}"/>
						<TextBox Grid.Row="1" Grid.Column="0"
									 Text="{Binding LogDirectory, UpdateSourceTrigger=PropertyChanged}"
									 Style="{StaticResource StyleSettingsInputSmall}"
									 Margin="4"/>
						<Button Grid.Row="1" Grid.Column="1" Content="â€¦"
								Command="{Binding BrowseLogDirectoryCommand}"
								Margin="4"
								Style="{StaticResource SecondaryButtonStyle}"/>
						<Button Grid.Row="1" Grid.Column="2" Content="Time Log"
								Margin="4"
								Command="{Binding OpenTimeLogCommand}"
								Style="{StaticResource SecondaryButtonStyle}"/>
						<TextBlock Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
								   Text="Leave empty to disable logging"
								   Style="{StaticResource StyleSettingsHint}"/>
					</Grid>

					<!-- Topmost Enforcement Interval -->
					<Grid Margin="0,12,0,0">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>
						<Grid.RowDefinitions>
							<RowDefinition Height="*"/>
							<RowDefinition Height="*"/>
							<RowDefinition Height="*"/>
						</Grid.RowDefinitions>
						<TextBlock Grid.Row="0" Grid.Column="0"  Grid.ColumnSpan="2"
								   Text="Topmost Interval, sec:"
								   VerticalAlignment="Center"
								   Style="{StaticResource StyleSettingsLabel}"/>
						<TextBox Grid.Row="0" Grid.Column="2" 
								 Text="{Binding TopmostEnforcementIntervalSeconds, UpdateSourceTrigger=PropertyChanged}"
								 HorizontalContentAlignment="Center"
								 Style="{StaticResource StyleSettingsInput}"/>
						<TextBlock Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="4"
								   Text="How often to enforce window stays on top (1-60 seconds)"
								   Style="{StaticResource StyleSettingsHint}"/>
					</Grid>

					<StackPanel Margin="0,12,0,0">
					</StackPanel>
				</StackPanel>
			</Grid>
		</Border>

		<!-- Confirmation Overlay -->
		<local:ConfirmationOverlay x:Name="ConfirmationOverlay"
                                   Visibility="Collapsed"
								   Confirmed="ConfirmationOverlay_Confirmed"
								   Cancelled="ConfirmationOverlay_Cancelled"/>
		<local:JiraCredentialsOverlay x:Name="JiraCredentialsOverlay"
									  Visibility="Collapsed"
									  CredentialsSubmitted="JiraCredentialsOverlay_CredentialsSubmitted"
									  Cancelled="JiraCredentialsOverlay_Cancelled"/>	
	</Grid>
</Window>
