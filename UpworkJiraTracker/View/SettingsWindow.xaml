<Window x:Class="UpworkJiraTracker.View.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:UpworkJiraTracker.XAML"
        xmlns:converters="clr-namespace:UpworkJiraTracker.XAML.Converter"
        mc:Ignorable="d"
        Title="Settings"
        Height="500"
        Width="320"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        ShowInTaskbar="False"
        ResizeMode="NoResize"
        Deactivated="Window_Deactivated">

	<Window.Resources>
		<converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
		<converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
		<converters:UpworkStateToFillConverter x:Key="UpworkStateToFillConverter"/>
		<converters:UpworkStateToTooltipConverter x:Key="UpworkStateToTooltipConverter"/>
	</Window.Resources>

	<Grid>
		<Border Background="White"
            BorderBrush="#CCCCCC"
            BorderThickness="1"
            CornerRadius="6"
            Padding="0">
			<Border.Effect>
				<DropShadowEffect BlurRadius="15"
                            ShadowDepth="2"
                            Opacity="0.3"
                            Color="Black"/>
			</Border.Effect>

			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="*"/>
				</Grid.RowDefinitions>

				<!-- Title bar with close button -->
				<Border Grid.Row="0"
                   Background="#F5F5F5"
                   BorderBrush="#CCCCCC"
                   BorderThickness="0,0,0,1"
                   CornerRadius="6,6,0,0"
                   Padding="12,8">
					<Grid>
						<TextBlock Text="Settings"
                              Style="{StaticResource StyleSettingsTitle}"/>

						<Button x:Name="CloseButton"
                           Content="âœ•"
                           HorizontalAlignment="Right"
                           Style="{StaticResource StyleCloseButton}"
                           Command="{Binding CloseCommand}"/>
					</Grid>
				</Border>

				<!-- Settings content -->
				<StackPanel Grid.Row="1"
                       Margin="16">

					<!-- Timezones -->
					<StackPanel Margin="0,0,0,12">
						<Grid>
							<TextBlock Text="Timezones:"
                                  Style="{StaticResource StyleSettingsLabel}"
                                  HorizontalAlignment="Left"/>
							<Button Content="+ Add"
                               HorizontalAlignment="Right"
                               Style="{StaticResource StyleAddButton}"
                               Command="{Binding AddTimezoneCommand}"/>
						</Grid>
						<ListBox x:Name="TimezonesListBox"
                            ItemsSource="{Binding Timezones}"
                            Height="100"
                            BorderBrush="#CCCCCC"
                            BorderThickness="1"
                            Padding="4">
							<ListBox.ItemTemplate>
								<DataTemplate>
									<Grid Margin="0,2">
										<Grid.ColumnDefinitions>
											<ColumnDefinition Width="*"/>
											<ColumnDefinition Width="Auto"/>
										</Grid.ColumnDefinitions>
										<TextBlock Grid.Column="0">
                                            <Run Text="{Binding Caption}" FontWeight="SemiBold"/>
                                            <Run Text=" - " Foreground="#999999"/>
                                            <Run Text="{Binding TimeZoneId}" FontSize="10" Foreground="#666666"/>
										</TextBlock>
										<Button Grid.Column="1"
                                           Content="âœ•"
                                           Style="{StaticResource StyleRemoveButton}"
                                           Command="{Binding DataContext.RemoveTimezoneCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                           CommandParameter="{Binding}"/>
									</Grid>
								</DataTemplate>
							</ListBox.ItemTemplate>
						</ListBox>
					</StackPanel>

					<!-- Window Size and Color -->
					<Grid Margin="0,0,0,4">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>
						<Grid.RowDefinitions>
							<RowDefinition/>
							<RowDefinition/>
						</Grid.RowDefinitions>

						<TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
							   Text="Window Size:"
							   Style="{StaticResource StyleSettingsLabel}"/>

						<TextBox Grid.Row="1" Grid.Column="0"
								 Text="{Binding MainWindowWidth, UpdateSourceTrigger=PropertyChanged}"
								 HorizontalContentAlignment="Center"
								 VerticalAlignment="Center"
								 Style="{StaticResource StyleSettingsInput}"
								 Margin="0,0,4,0"/>

						<TextBox Grid.Row="1" Grid.Column="1"
								 Text="{Binding MainWindowHeight, UpdateSourceTrigger=PropertyChanged}"
								 HorizontalContentAlignment="Center"
								 VerticalAlignment="Center"
								 Style="{StaticResource StyleSettingsInput}"
								 Margin="0,0,4,0"/>

						<TextBlock Grid.Row="0" Grid.Column="2" Grid.ColumnSpan="3"
								   Text="Background Color:"
								   Style="{StaticResource StyleSettingsLabel}"/>
						<Button Grid.Row="1" Grid.Column="2"  x:Name="ColorPreview"
								Content="ðŸŽ¨"
								Margin="0,0,4,0"
								Height="28"
								Background="#333333"
								Command="{Binding PickColorCommand}"
								Style="{StaticResource SecondaryButtonStyle}"/>
						<Button Grid.Row="1" Grid.Column="3"
								Content="ðŸŽ¨"
								Height="28"
								Command="{Binding ResetColorCommand}"
								Style="{StaticResource SecondaryButtonStyle}"/>
					</Grid>

					<!-- Jira Integration -->
					<Grid Margin="0,12,0,0">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>
						<Grid.RowDefinitions>
							<RowDefinition Height="*"/>
							<RowDefinition Height="*"/>
							<RowDefinition Height="*"/>
						</Grid.RowDefinitions>
						<TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" 
								   Text="Integrations:"
								   Style="{StaticResource StyleSettingsLabel}"/>
						<Button Grid.Column="0" Grid.Row="1" x:Name="ConnectJiraButton"
								Content="Connect to Jira"
								Height="32"
								Visibility="{Binding IsJiraConnected, Converter={StaticResource InverseBoolToVisibilityConverter}}"
								Command="{Binding ConnectJiraCommand}"
								Style="{StaticResource SecondaryButtonStyle}"/>
						<Button Grid.Column="0" Grid.Row="1" x:Name="DisconnectJiraButton"
								Content="Disconnect Jira"
								Height="32"
								Visibility="{Binding IsJiraConnected, Converter={StaticResource BoolToVisibilityConverter}}"
								Command="{Binding DisconnectJiraCommand}"
								Style="{StaticResource SecondaryButtonStyle}"/>
						<TextBlock Grid.Column="0" Grid.Row="2" 
								   x:Name="JiraStatusText"
								   Style="{StaticResource StyleSettingsStatusText}"
								   Text="{Binding JiraStatusText}"/>
						<Border Grid.Column="1" Grid.Row="1"
								x:Name="UpworkStatusIcon"
								HorizontalAlignment="Center"
								VerticalAlignment="Center"
								ToolTip="{Binding UpworkState, Converter={StaticResource UpworkStateToTooltipConverter}}">
							<Viewbox Width="90" Height="45" Stretch="Uniform">
								<Canvas Width="120" Height="60">
									<Path Data="M76.082 21.118c-4.79.023-8.692 3.96-8.67 8.862s3.963 8.802 8.753 8.78 8.693-3.96 8.67-8.86-3.963-8.803-8.755-8.78zm.066 14.047c-1.358.008-2.663-.525-3.628-1.48s-1.5-2.256-1.515-3.614.525-2.663 1.48-3.628 2.256-1.5 3.614-1.515 2.663.525 3.628 1.48 1.5 2.256 1.515 3.614c.014 2.725-2.37 5.13-5.094 5.144zm19.34-9.892c-2.505.012-4.456 2.09-4.444 4.595l.04 8.385-3.812.018-.077-16.663 3.812-.018.013 2.613s1.62-2.62 4.888-2.635l1.09-.006.018 3.702zM57.462 21.75l2.886 11.422 2.996-11.45 3.812-.017L62.44 38.4l-3.702.017-2.994-11.638-2.886 11.665-3.703.017-4.978-16.64 3.702-.017 3.32 11.42 2.67-11.448zm50.675 7.386c2.605-1.536 4.445-4.377 4.43-7.644l-3.812.018c.014 2.832-2.264 5.13-4.986 5.14l-.545.002-.06-13.177-3.812.018.117 24.72 3.81-.017-.036-7.84.435-.002c.436-.002.873.214.984.54l5.37 7.27 4.465-.02z"
										  Fill="{Binding UpworkState, Converter={StaticResource UpworkStateToFillConverter}, ConverterParameter=#4b4b4b}"/>
									<Path Data="M35.353 21.31c-4.137.02-7.283 2.757-8.46 7.118-1.975-3.04-3.516-6.517-4.4-9.453l-4.355.02.054 11.543a4.14 4.14 0 0 1-4.119 4.158 4.14 4.14 0 0 1-4.158-4.119L9.86 19.034l-4.357.02.054 11.543c.023 4.79 3.85 8.586 8.534 8.563s8.478-3.852 8.456-8.643l-.01-1.96c.878 1.737 1.976 3.583 3.183 5.212l-2.663 12.753 4.464-.02 1.92-9.266c1.747 1.082 3.7 1.725 5.996 1.714 4.792-.023 8.695-3.96 8.67-8.97a8.74 8.74 0 0 0-8.753-8.671zm.062 13.177c-1.742.008-3.487-.746-4.908-1.938l.427-1.743v-.1c.32-1.854 1.282-5.016 4.55-5.03A4.37 4.37 0 0 1 39.861 30c-.098 2.505-2.157 4.475-4.445 4.486z"
										  Fill="{Binding UpworkState, Converter={StaticResource UpworkStateToFillConverter}, ConverterParameter=#6fda44}"/>
								</Canvas>
							</Viewbox>
						</Border>
					</Grid>

					<!-- Log Directory -->
					<StackPanel Margin="0,12,0,0">
						<TextBlock Text="Log Directory:"
                              Style="{StaticResource StyleSettingsLabel}"/>
						<Grid>
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="*"/>
								<ColumnDefinition Width="Auto"/>
							</Grid.ColumnDefinitions>
							<TextBox Grid.Column="0"
									 Text="{Binding LogDirectory, UpdateSourceTrigger=PropertyChanged}"
									 Style="{StaticResource StyleSettingsInputSmall}"
									 Margin="0,0,4,0"/>
							<Button Grid.Column="1"
									Content="..."
									Width="28"
									Height="28"
									Command="{Binding BrowseLogDirectoryCommand}"
									Style="{StaticResource SecondaryButtonStyle}"/>
						</Grid>
						<TextBlock Text="Leave empty to disable logging"
                              Style="{StaticResource StyleSettingsHint}"/>
					</StackPanel>
				</StackPanel>
			</Grid>
		</Border>

		<!-- Confirmation Overlay -->
		<local:ConfirmationOverlay x:Name="ConfirmationOverlay"
                                   Visibility="Collapsed"/>
	</Grid>
</Window>
